{% for station in stations %}
<div class="station-card">
    <div class="station-header">
        <div class="freq-box">
            <span class="freq-val">{{ "%.1f"|format(station.frequency) }}</span>
            <span class="freq-unit">MHz</span>
        </div>
        <div class="station-meta">
            <span class="last-seen">Last: {{ station.last_seen.split(' ')[1].split('.')[0] if station.last_seen else
                'N/A' }}</span>
            <span class="hit-counter" title="Total RDS packets received for this station">SCAN COUNT: {{
                station.hit_count }}</span>
        </div>
    </div>

    <div class="station-content">
        <div class="pi-tag" title="Program Identification code">PI: {{ station.pi if station.pi else '0000' }}</div>

        <div class="station-info">
            <div class="ps-display {{ 'empty' if not station.ps }}">
                {{ station.ps if station.ps else "SEARCHING NAMES..." }}
            </div>
            <div class="pty-label">{{ station.pty | pty_name }}</div>
        </div>

        {% if station.rt %}
        <div class="rt-display">
            <div class="rt-scroll">{{ station.rt }}</div>
        </div>
        {% endif %}

        <div class="flags-grid">
            <div class="flag-item {{ 'active' if station.tmc }}" title="Traffic Message Channel">
                <span class="flag-indicator"></span> TMC
            </div>
            <div class="flag-item {{ 'active' if station.ta }}" title="Traffic Announcement">
                <span class="flag-indicator"></span> TA
            </div>
            <div class="flag-item {{ 'active' if station.tp }}" title="Traffic Programme">
                <span class="flag-indicator"></span> TP
            </div>
        </div>
    </div>
</div>
{% endfor %}

{% if not stations %}
<div
    style="padding:40px; text-align:center; color:#555; background:rgba(0,0,0,0.2); border-radius:8px; border:2px dashed #333;">
    <p style="font-size:1.2em; letter-spacing:1px;">NO SIGNAL DETECTED</p>
    <small>Initialize scan to capture traffic</small>
</div>
{% endif %}

<style>
    .station-card {
        background: #12141d;
        border: 1px solid #232738;
        border-radius: 8px;
        margin-bottom: 20px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    }

    .station-header {
        background: #1a1d2e;
        padding: 10px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #2e344e;
    }

    .freq-box {
        color: #00d2ff;
        font-family: 'JetBrains Mono', monospace;
        font-weight: 800;
    }

    .freq-val {
        font-size: 1.4em;
    }

    .freq-unit {
        font-size: 0.8em;
        margin-left: 4px;
        opacity: 0.7;
    }

    .station-meta {
        text-align: right;
        font-family: 'Inter', sans-serif;
        font-size: 0.75em;
        color: #64748b;
        display: flex;
        flex-direction: column;
    }

    .hit-counter {
        color: #00ff41;
        font-weight: bold;
        margin-top: 2px;
    }

    .station-content {
        padding: 15px;
        position: relative;
    }

    .pi-tag {
        position: absolute;
        top: 10px;
        right: 15px;
        font-family: monospace;
        background: #2e344e;
        color: #94a3b8;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.7em;
    }

    .station-info {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
    }

    .ps-display {
        font-size: 1.8em;
        font-weight: 900;
        letter-spacing: 2px;
        color: #fff;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        text-transform: uppercase;
    }

    .ps-display.empty {
        color: #2e344e;
        font-style: italic;
        letter-spacing: 1px;
    }

    .pty-label {
        background: #334155;
        color: #f1f5f9;
        padding: 2px 10px;
        border-radius: 20px;
        font-size: 0.7em;
        font-weight: bold;
        text-transform: uppercase;
        margin-top: 5px;
    }

    .rt-display {
        background: #000;
        border: 1px solid #004d1a;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 15px;
        font-family: 'JetBrains Mono', monospace;
        color: #00ff41;
        font-size: 0.9em;
        overflow: hidden;
    }

    .flags-grid {
        display: flex;
        gap: 12px;
    }

    .flag-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.75em;
        font-weight: bold;
        color: #334155;
        transition: color 0.3s;
    }

    .flag-item.active {
        color: #e2e8f0;
    }

    .flag-indicator {
        width: 8px;
        height: 8px;
        background: #1e293b;
        border-radius: 50%;
        box-shadow: inset 0 0 3px rgba(0, 0, 0, 0.5);
    }

    .flag-item.active[title*="TMC"] .flag-indicator {
        background: #ff0055;
        box-shadow: 0 0 8px #ff0055;
    }

    .flag-item.active[title*="Announcement"] .flag-indicator {
        background: #ffaa00;
        box-shadow: 0 0 8px #ffaa00;
    }

    .flag-item.active[title*="Programme"] .flag-indicator {
        background: #00d2ff;
        box-shadow: 0 0 8px #00d2ff;
    }
</style>